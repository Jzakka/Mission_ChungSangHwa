# 2Week_정상화.md

## Title: [2Week] 정상화

### 미션 요구사항 분석 & 체크리스트

---
> - [X] 중복정보로 호감표시 불가
> - [X] 한 사람당 호감표시 최대 10명까지
> - [X] 호감사유를 변경 허용
> - [x] [선택] 네이버 로그인

### 2주차 미션 요약

---

**[접근 방법]**

체크리스트를 중심으로 각각의 기능을 구현하기 위해 어떤 생각을 했는지 정리합니다.

>**중복 호감 제한&호감 사유 변경**

likeablePerson에서 좋아하는 사람, 당한 사람을 기준으로 존재여부확인

|likeablePerson 존재여부 <br/> 호감사유일치여부 \ | 있음                | 없음         |
|--------------------------------|-------------------|------------|
| same                           | 중복데이터임, <br/>추가안함 | 다음 제한조건 체크 |
| different                      | 호감사유변경            | 다음 제한조건 체크 |

>**최대 호감 제한**

1. 사용자의 호감목록을 가져온다.
2. 호감목록의 size()가 10미만일 때만 데이터 추가

>**네이버 로그인**

- 기존 카카오 로그인과 yml설정하는 방법은 같음
- 문제는 데이터형식이 카카오, 구글과 다르게 getName()호출 시 키-값 쌍의 사용자 정보가 나옴
- 디버거를 통해 LinkedHashMap으로 구현돼있는 것을 확인
- provider가 `naver`이면 Map으로 캐스팅후 id추출 

>**리팩터링**
- likeablePerson을 추가하는 과정에 너무 많은 검증 절차가 요구됨
- 검증로직을 validator에게 위임
- RsData에 체인호출 스타일의 메서드를 만들어서 이 메서드로 검증을 진행

**[특이사항]**

구현 과정에서 아쉬웠던 점 / 궁금했던 점을 정리합니다.

- DB 자체에서도 앞의 제한 조건을 걸 수는 없는지
  - 컬럼 여러개(`fromInstaMemberId`와 `toInstaMemberId`)를 하나의 unique로 보기
- like() 메서드에서 rsData를 익명함수의 인자로 넘길 때 왜 타입캐스팅을 해야하는 지 모르겠음
- 지네릭스에 대한 이해도가 부족해서 이 부분을 더 깔끔한 코드로 바꾸기가 쉽지 않음
- Validator 클래스를 따로 만들긴 했는데 이게 일반적인지는 잘 모르겠음
- 카카오, 구글, 네이버 등 서비스에 따라서 CustomOAuth2UserService를 만들어서 provider에 따라 적절한 구현체를 주입하고 싶다
- 근데 어떻게 해야 그게 가능한 지 모르겠음
- 스프링시큐리티에서 DefaultOAuth2UserService의 빈을 자기 기준대로 선택하는 것 같은데, 이것까지 알려면 너무 프레임워크의 내부까지 파헤치려는 것이 아닌지 싶음